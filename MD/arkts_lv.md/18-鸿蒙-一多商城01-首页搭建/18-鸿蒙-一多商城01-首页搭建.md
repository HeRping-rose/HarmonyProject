# 5. 工程级一多（掌握）

[工程管理](https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-layered-architecture-design-V5)

## 5.1. 概念

一多模式下，官方推荐在开发过程中采用"三层工程架构"，其实就是**把项目拆分成不同类型的模块，再通过模块之间的引用组合，最终实现应用功能**，拆分规范如下：

- commons(公共能力层)：用于存放公共基础能力合集，比如工具库，公共配置等
- features(基础特性层)：用于存放应用中相对独立的各个功能的UI以及业务逻辑实现
- products(产品定制层)：用于针对不同设备形态进行功能和特性集成，作为应用入口

手机-折叠屏-平板

products：只是一个入口，应该不负责具体的业务，可以写业务

features：写具体业务，把每个业务拆分成具体的模块 N个，方便维护

commons： 提供基础组件-基础工具-基础类型- 架构组-技术平台组



hap-可以用Ability

har-没有Ability-重复拷贝

hsp-没有Ability-直接引用没有拷贝



**注意：面试要问！！！**

[包的区别](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-structure-stage-V5#选择合适的包类型)

参考官方示例：美蔻商城将进行如下拆分

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717149698534-40fc215e-39a8-4831-8055-5ef57e0d5a26.png)

1. common设计为hsp包，新建module时选择`Shared Library`, 内部存放全局通用的工具函数，公共配置等
2. feature设计为hsp包，新建module时选择 `Shared Library`, 内部存放相对独立的业务单元，比如`购物车` 、`我的` 、`分类`、`Home` ，也就是首页底部Tab切换时的四个核心业务模块
3. product为产品层，里面放置phone模块，也就是入口模块，在phone中我们放置入口ability和所有页面级别的组件（hap）

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717149305821-e77973cd-8d42-416f-82c6-924946c15dc2.png)

选用 **Shared Library**的原因：

![img](https://cdn.nlark.com/yuque/0/2024/png/8435673/1712916416182-07dc1510-8dc3-4407-a57c-4678af9b21ff.png?x-oss-process=image%2Fformat%2Cwebp)



## 5.2. 项目搭建

接下来咱们完成项目搭建，参考下图

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717343762739-b361189f-896e-4394-abba-67cf4853d44a.png)

**核心步骤：**

1. 创建项目: 项目名用 AGC 平台创建的项目名
2. 创建目录 commons、features、products
3. commons目录下

- - 创建 **Shared Library，**起名 basic，存放全局通用的工具函数，公共配置等

1. features 目录下：

- - 创建 **Shared Library：**内部存放相对独立的业务单元，比如`购物车（cart）` 、`我的(my)` 、`分类(category)`、`首页（home)` ，也就是首页底部Tab切换时的四个核心业务模块

1. products 目录下：

- - 将原本的 **entry**，移入该目录并改名为 **phone**

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717381715200-4aaad0ed-c18e-413d-b823-82ffe9adbeeb.png)



![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717343980456-17ea7df0-fc18-4c82-b8ab-ccbc4327e323.png)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717343999452-d3a564e7-30e9-485a-aacc-67fea4d0bd90.png)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724049366986-2c5b6f81-1fe1-4a56-bbd4-3816c7bd25be.png?x-oss-process=image%2Fformat%2Cwebp)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717344045130-7fb1a99c-f166-4fe4-9ad3-ccb327f66997.png)

**注意： 运行时， 入口选择phone**

![img](https://cdn.nlark.com/yuque/0/2025/png/38706227/1742740903025-b16f9d3c-c900-42de-b022-467700854b70.png)



# 6. 准备工作：

接下来完成模块编码前期的准备工作

1. 图标+名字
2. 底部 tabs
3. 日志工具



## 6.1. 图标+名字

要调整的地方有 2 个

1. 管理界面的名字+图标
2. 桌面的名字+图标

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717380677628-757ff7b4-f6f6-4d19-84c5-1085cfa71f36.png)![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717380707086-32a53ec6-a033-4f95-ae48-5f96506ddede.png)



1. 管理界面图标+名字：[📎应用管理界面图标.zip](https://www.yuque.com/attachments/yuque/0/2025/zip/38706227/1747031189167-78f19d2d-f33d-4f5a-90f6-2645e6655ea6.zip)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717380803871-40e7ca5f-fb0b-424b-88cd-6f1fba16ddfe.png)

1. 桌面的名字+图标

```ts
{
  "module": {
    "name": "phone",
    "type": "entry",
    "description": "$string:module_desc",
    "mainElement": "EntryAbility",
    "deviceTypes": [
      "phone",
      "tablet",
      "2in1"
    ],
    "deliveryWithInstall": true,
    "installationFree": false,
    "pages": "$profile:main_pages",
    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "$string:EntryAbility_desc",
        "icon": "$media:foreground",
        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:startIcon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true,
        "skills": [
          {
            "entities": [
              "entity.system.home"
            ],
            "actions": [
              "action.system.home"
            ]
          }
        ]
      }
    ]
  }
}
```



## 6.2. 底部 tabs 搭建：

[跨 HAP/HSP应用资源](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5#跨haphsp包应用资源)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717345327177-b502374d-1bf7-4abb-93c8-8e88e7aca6ba.png)

**基础模版：**

```ts
products/phone/src/main/ets/pages/Index.ets


interface TabItem {
  text: string
  normal: ResourceStr
  active: ResourceStr
}

@Entry
@ComponentV2
struct Index {
  @Local
  activeIndex: number = 0
  list: TabItem[] = [
    { text: '首页', normal: $r('app.media.ic_public_home_normal'), active: $r('app.media.ic_public_home_active') },
    { text: '分类', normal: $r('app.media.ic_public_pro_normal'), active: $r('app.media.ic_public_pro_active') },
    { text: '购物袋', normal: $r('app.media.ic_public_cart_normal'), active: $r('app.media.ic_public_cart_active') },
    { text: '我的', normal: $r('app.media.ic_public_my_normal'), active: $r('app.media.ic_public_my_active') },
  ]

  @Builder
  getTabItemBuilder(item: TabItem, index: number) {
    Column() {
      Image(this.activeIndex === index ? item.active : item.normal)
        .width(24)
        .aspectRatio(1)
      Text(item.text)// 跨 HSP 访问资源，需要在 oh-package.json5中导入
        .fontColor($r('[basic].color.black'))
        .fontSize(12)
    }
    .justifyContent(FlexAlign.SpaceEvenly)
    .height(50)
  }

  build() {
    Tabs({ barPosition: BarPosition.End, index: $$this.activeIndex }) {
      ForEach(this.list, (item: TabItem, index: number) => {
        TabContent() {

        }
        .tabBar(this.getTabItemBuilder(item, index))
      })
    }
    .scrollable(false)
  }
}
```

1. 

2. ```
   {
     "name": "phone",
     "version": "1.0.0",
     "description": "Please describe the basic information.",
     "main": "",
     "author": "",
     "license": "",
     "dependencies": {
       "basic": "file:../../commons/basic",
     }
   }
   ```

3. 



**颜色:**

```ts
{
  "color": [
    {
      "name": "black",
      "value": "#191919"
    },
    {
      "name": "white",
      "value": "#FFFFFF"
    },
    {
      "name": "text",
      "value": "#434343"
    },
    {
      "name": "gray",
      "value": "#A6A3AD"
    },
    {
      "name": "red",
      "value": "#FF2737"
    },
    {
      "name": "linear_begin",
      "value": "#FD3F8F"
    },
    {
      "name": "linear_end",
      "value": "#FF773C"
    },
    {
      "name": "yellow",
      "value": "#F2E7DC"
    },
    {
      "name": "under",
      "value": "#F5F4F9"
    },
    {
      "name": "border",
      "value": "#e4e4e4"
    }
  ]
}

```

注意：

1. key为使用模块时的名字，它只是一个标识，保持规范即可，value为模块的实际地址，不能写错
2. 跨模块访问资源，需要【先导入模块】才可以访问





## 6.3. 引入 features 模块

接下来将 4 个 tabs 对应的组件创建好并整合到 index 页面，这几个都是 tabs 管理的组件

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724057801414-00a98fce-1786-4124-9ab1-1fc5e9a46123.png?x-oss-process=image%2Fformat%2Cwebp)

**核心步骤：**

1. 创建基本页面:
2. 导出:
3. 导入并使用

1. 创建基本页面：

1. 1. ets 下创建 views 目录，页面命名参考：

1. 1. 1. CartView：购物车
      2. CategoryView：分类
      3. HomeView：主页
      4. MyView：我的

1. 1. 页面内容参考截图，设置基础结构即可

![img](https://cdn.nlark.com/yuque/0/2025/png/38706227/1747031876997-f49ddeb4-9999-4d31-9b85-29a14028f85a.png)

1. 导出:

1. 1. 4个 tabs 对应的模块都需要导出
   2. 参考代码如下

```ts
cart/index.ets
export { CartView } from './src/main/ets/views/CartView'
```

1. 导入并使用:

```ts
{
  "name": "phone",
  "version": "1.0.0",
  "description": "Please describe the basic information.",
  "main": "",
  "author": "",
  "license": "",
  "dependencies": {
    "basic": "file:../../commons/basic"
    "home": "file:../../features/home",
    "cart": "file:../../features/cart",
    "category": "file:../../features/category",
    "my": "file:../../features/my",
  }
}
import { TabItem } from 'basic'
import { HomeView } from 'home/Index';
import { CategoryView } from 'category/Index';
import { CartView } from 'cart/Index';
import { MyView } from 'my/Index';

@Entry
@ComponentV2
struct Index {
  @Local
  activeIndex: number = 0
  list: TabItem[] = [
    { text: '首页', normal: $r('app.media.ic_public_home_normal'), active: $r('app.media.ic_public_home_active') },
    { text: '分类', normal: $r('app.media.ic_public_pro_normal'), active: $r('app.media.ic_public_pro_active') },
    { text: '购物袋', normal: $r('app.media.ic_public_cart_normal'), active: $r('app.media.ic_public_cart_active') },
    { text: '我的', normal: $r('app.media.ic_public_my_normal'), active: $r('app.media.ic_public_my_active') },
  ]

  build() {
    Tabs({ barPosition: BarPosition.End }) {
      ForEach(this.list, (item: TabItem, index: number) => {
        TabContent() {
          if (index == 0) {
            HomeView()
          } else if (index == 1) {
            CategoryView()
          } else if (index == 2) {
            CartView()
          } else {
            MyView()
          }
        }
        .tabBar(this.TabItemBuilder(item, index))
      })
    }
    .scrollable(false)
    .onTabBarClick(index => {
      this.activeIndex = index
    })
  }

  @Builder
  TabItemBuilder(item: TabItem, index: number) {
    Column() {
      Image(this.activeIndex === index ? item.active : item.normal)
        .width(24)
        .aspectRatio(1)
      Text(item.text)
        .fontColor($r('app.color.black'))
        .fontSize(12)
    }
    .justifyContent(FlexAlign.SpaceEvenly)
    .height(50)
  }


}
```

git记录：

**引入 features 模块**

## 6.4. 日志工具：

[Logger 工具](https://ohpm.openharmony.cn/#/cn/detail/@abner%2Flog)

HarmonyOsLog是一个日志打印工具，支持hilog和console两种工具打印，支持各种类型包含JSON格式化打印，非常的方便！



![img](https://cdn.nlark.com/yuque/0/2024/jpeg/639379/1717378998616-7a2b3929-75ff-47c8-9f25-94da5ffbc784.jpeg)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717378998715-cfa04c40-e6f4-464a-90be-417e4b65bd11.png)

需求：

1. 在commons/basic

1. 1. 下载 logger 日志工具
   2. 完成初始化并导出，起别名Logger

1.  products/phone中测试使用



1. 安装

  a. 在 commons/basic下打开终端进行安装
  b. mac 和 window 界面可能略有差异

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724058661745-a164c9ad-2832-40a6-b023-ceba455e5e51.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_518%2Climit_0)

```arkts
ohpm install @abner/log
```

1. 初始化，起别名，导出

```typescript
import { Log } from '@abner/log'

// 初始化
Log.init({
  tag: "MkLog",
  domain: 0x0101,
  close: false,
  isHilog: true,
  showLogLocation: true,
  logSize: 1024
})


export {
  Log as Logger
}

```

```

export { Logger } from './src/main/ets/utils/Logger'
```



1. 测试使用:

```ts
// 导入
import { Logger } from '@mk/basic'


// 测试使用
aboutToAppear(): void {
    Logger.info({
      name: '鸿蒙牛逼',
      age: 18
    })
}
```

![img](https://cdn.nlark.com/yuque/0/2024/png/38706227/1724050104866-e4a50fbc-daec-460d-8a88-fda82079d9f8.png)



# 二、首页模块

核心：

Home 模块：

1. 页面适配
2. 网络数据整合



# 1. 页面级一多开发：

## 1.1. phone-tabs 适配

完成 tabs 部分的 ui 适配

[tabs文档](https://docs.openharmony.cn/pages/v4.1/zh-cn/application-dev/ui/arkts-navigation-tabs.md)

**需求：**

1. sm、md：底部
2. lg:左侧

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717405458911-f01365a1-b1b0-4b4d-b10f-6448fea8b6bd.png)![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717405435344-c1ea750e-9614-4a4a-93c7-242b08813e75.png)

核心步骤

- 在common/basic模块中建立一个媒体查询的工具
- 建立对应的断点枚举
- 建立对应的AppStorageV2的存储断点对象
- 在products/phone 的ability中进行监听和卸载监听- 只能在加载页面之后执行（需要注意）
- 根据断点值 => tabs的tabBar在lg模式下放到左侧
- 将官方的推荐的断点描述工具放置在basic模块下
- 使用描述工具将lg模式下的tabbar放到左侧



- 定义相应的枚举

```ts
commons/basic/src/main/ets/viewmodels/break_point.ets

export enum BreakPointEnum {
  XS = "xs",
  SM = "sm",
  MD = "md",
  LG = "lg"
}
```

- 定义全局状态共享状态

```typescript
commons/basic/src/main/ets/viewmodels/common.ets

import { BreakPointEnum } from "./break_point";

// V2的共享类的状态
@ObservedV2
export class AppBreakPoint {
  @Trace
  breakPoint: BreakPointEnum = BreakPointEnum.XS
}

```

```ts
commons/basic/src/main/ets/viewmodels/index.ets

export * from './break_point' // 导出断点
export * from './common' // 导出公共的属性
```



---------------

```ts
commons/basic/src/main/ets/utils/BreakPointUtil.ets

import { Context } from "@kit.AbilityKit"
import { AppStorageV2, display, window } from "@kit.ArkUI"
import { AppBreakPoint, BreakPointEnum } from "../viewmodels"

export class ScreenManager {
  ctx?: Context

  // 注册屏幕宽度变化
  async registerWindowSizeChange() {
    const win = await this.getWin() // 获取window对象
    this.judgeScreen(px2vp(display.getDefaultDisplaySync().width)) // 第一次手动判断一次
    win.on("windowSizeChange", (size) => {
      this.judgeScreen(px2vp(size.width)) // vp区间
    })
  }

  // 判断屏幕
  judgeScreen(width: number) {
    let breakPoint: BreakPointEnum = BreakPointEnum.XS
    if (width > 0 && width < 320) {
      breakPoint = BreakPointEnum.XS
    } else if (width >= 320 && width < 520) {
      breakPoint = BreakPointEnum.SM
    } else if (width >= 520 && width < 840) {
      breakPoint = BreakPointEnum.MD
    } else {
      breakPoint = BreakPointEnum.LG
    }
    //   V1 AppStorage.setOrCreate("key", "value")
    const app = AppStorageV2.connect(AppBreakPoint, () => new AppBreakPoint())!
    app.breakPoint = breakPoint // 将断点值存入到全局状态
  }

  // 取消注册
  async unRegisterWindowSizeChange() {
    const win = await this.getWin() // 获取window对象
    win.off("windowSizeChange") // 卸载监听
  }

  getWin() {
    return window.getLastWindow(this.ctx || getContext())
  }
}

export const screenManager = new ScreenManager()
```

```ts
src/main/ets/utils/Logger.ets

export * from './BreakPointUtil' // 屏幕管理工具
export * from './Logger' // 请求工具
```

```ts
commons\basic\Index.ets

export * from './src/main/ets/viewmodels' // 向外暴露类型
export * from './src/main/ets/utils' // 工具使用
```



- 在ability中监听媒体查询和卸载媒体

```ts
products/phone/src/main/ets/entryability/EntryAbility.ets


onWindowStageCreate(windowStage: window.WindowStage): void {
    // Main window is created, set main page for this ability
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onWindowStageCreate');
    screenManager.ctx = this.context
    screenManager.registerWindowSizeChange() // 注册屏幕变化
    windowStage.loadContent('pages/Index', (err) => {
      if (err.code) {
        hilog.error(DOMAIN, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err));
        return;
      }
      hilog.info(DOMAIN, 'testTag', 'Succeeded in loading the content.');
    });
  }

  onWindowStageDestroy(): void {
    // Main window is destroyed, release UI related resources
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onWindowStageDestroy');
    screenManager.unRegisterWindowSizeChange() // 取消注册
  }
```

- 放置一个断点描述工具到basic

```ts
commons/basic/src/main/ets/viewmodels/break_point.ets

export enum BreakPointEnum {
  XS = "xs",
  SM = "sm",
  MD = "md",
  LG = "lg"
}

// 封装一个工具 可以帮我们实现适配的更简单一点

interface BreakPointOption<T> {
  xs?: T
  sm?: T
  md?: T
  lg?: T
}

export class BreakPointType<T> {
  options: BreakPointOption<T> = {}

  constructor(opt: BreakPointOption<T>) {
    this.options = opt // 将传入的断点的值赋值给对象
  }

  getValue(breakPoint: BreakPointEnum): T {
    return (this.options as object)[breakPoint]
    // if (breakPoint === BreakPointEnum.XS) {
    //   return this.options.xs!
    // } else if (breakPoint === BreakPointEnum.SM) {
    //   return this.options.sm!
    // } else if (breakPoint === BreakPointEnum.MD) {
    //   return this.options.md!
    // } else {
    //   return this.options.lg!
    // }
  }
}
```

- 在phone的入口首页实现lg模式下的适配

```ts
products/phone/src/main/ets/pages/Index.ets

import { AppBreakPoint, BreakPointType, TabItem } from 'basic'
import { CartView } from 'cart'
import { CategoryView } from 'category'
import { HomeView } from 'home'
import { MineView } from 'mine'
import { AppStorageV2 } from '@kit.ArkUI'

@Entry
@ComponentV2
struct Index {
  breakObj: AppBreakPoint = AppStorageV2.connect(AppBreakPoint, () => new AppBreakPoint())!
  @Local
  activeIndex: number = 0
  list: TabItem[] = [
    { text: '首页', normal: $r('app.media.ic_public_home_normal'), active: $r('app.media.ic_public_home_active') },
    { text: '分类', normal: $r('app.media.ic_public_pro_normal'), active: $r('app.media.ic_public_pro_active') },
    { text: '购物袋', normal: $r('app.media.ic_public_cart_normal'), active: $r('app.media.ic_public_cart_active') },
    { text: '我的', normal: $r('app.media.ic_public_my_normal'), active: $r('app.media.ic_public_my_active') },
  ]

  @Builder
  getTabItemBuilder(item: TabItem, index: number) {
    Column() {
      Image(this.activeIndex === index ? item.active : item.normal)
        .width(24)
        .aspectRatio(1)
      Text(item.text)// 跨 HSP 访问资源，需要在 oh-package.json5中导入
        .fontColor($r("[basic].color.black"))
        .fontSize(12)
    }
    .justifyContent(FlexAlign.SpaceEvenly)
    .height(50)
  }

  build() {
    Tabs({
      barPosition: new BreakPointType({
        sm: BarPosition.End,
        md: BarPosition.End,
        lg: BarPosition.Start
      }).getValue(this.breakObj.breakPoint), index: $$this.activeIndex
    }) {
      ForEach(this.list, (item: TabItem, index: number) => {
        TabContent() {
          if (index === 0) {
            HomeView()
          } else if (index === 1) {
            CategoryView()
          } else if (index === 2) {
            CartView()
          } else {
            MineView()
          }
        }
        .tabBar(this.getTabItemBuilder(item, index))
      })
    }
    .barHeight(new BreakPointType({
      sm: 60,
      md: 60,
      lg: 220
    }).getValue(this.breakObj.breakPoint))
    .vertical(new BreakPointType({
      sm: false,
      md: false,
      lg: true
    }).getValue(this.breakObj.breakPoint))
    .scrollable(false)
  }
}
```

![img](https://cdn.nlark.com/yuque/0/2025/png/8435673/1743040975825-d3ee5715-26e1-4b3e-ba84-54188a90ebf4.png)



## 1.2. Home 模块

Home 模块的一多开发

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717425374860-3b347ad9-f87f-4ecf-a2a5-e7abaa75f020.png)

### 1.2.1. 素材整合

将图片资源，页面，组件，模块这些整合进来

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724120393846-81402b54-4640-476a-8f17-165d0dba0a34.png)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724406716402-0d51e880-e2df-482b-aeca-c2336ee0e027.png)

**核心步骤：**

1. common：

1. 1. 通用图片：commons/basic/src/main/resources/base/media

1. 1. 

1. home:

1. 1. 图片资源

1. phone:(保证网络图片可以显示)

1. 1. 开启网络权限：products/phone/src/main/module.json5

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717495593129-08107f47-4ddd-439e-9929-888bb6e85530.png)

- 调整范围
- home模块的viewmodels/index.ets  统一管理模式
- home模块下components/index.ets 统一管理模式



- basic模块下统一管理的公共类型

```ts
commons/basic/src/main/ets/viewmodels/business.ets

export interface HDMGoodsItem {
  id: string
  name: string
  desc: string
  price: string
  picture: ResourceStr
  orderNum: number
}

export interface CategoryItem {
  children?: CategoryItemChild[]
  goods?: HDMGoodsItem[]
  id: string
  name: string
  picture: ResourceStr
}

export interface CategoryItemChild {
  id: string
  name: string
  picture: ResourceStr
}
```

- 在home模块添加对于basic依赖

```bash
{
  "name": "home",
  "version": "1.0.0",
  "description": "Please describe the basic information.",
  "main": "Index.ets",
  "author": "",
  "license": "Apache-2.0",
  "packageType": "InterfaceHar",
  "dependencies": {
    "basic": "file:../../commons/basic"
  }
}
```

- 在basic/viewmodes/index.ets统一注册

```ts
commons/basic/src/main/ets/viewmodels/index.ets

export * from './business'
```

- home模块下的组件

![img](https://cdn.nlark.com/yuque/0/2024/png/8435673/1730687936993-4897aadd-0378-49f1-b3c1-6a1b9bbb5817.png)

```ts
features/home/src/main/ets/components/HDMDiscountGoods.ets

import { HDMGoodsItem } from 'basic'
import { DiscountType } from '../viewmodels'


@ComponentV2
export struct HDMDiscountGoods {
  @Param type: DiscountType = DiscountType.COMMAND
  @Param
  goods: HDMGoodsItem = {} as HDMGoodsItem

  @Builder
  CommandBuilder() {
    Column() {
      Image(this.goods.picture)
        .width(70)
        .aspectRatio(1)
      Row() {
        Stack() {
          Polygon()
            .width(16)
            .height(20)
            .points([[0, 0], [4, 0], [7, 10], [4, 20], [0, 20]])
            .fill($r('[basic].color.white'))
          Polygon()
            .width(16)
            .height(20)
            .points([[4, 0], [12, 0], [9, 6], [16, 6], [4, 20], [7, 10], [0, 10]])
            .fill('#FFC060')
        }
        .offset({ x: -1 })

        Text('¥' + Number(this.goods.price))
          .fontSize(12)
          .fontWeight(500)
          .fontColor($r('[basic].color.white'))
          .textAlign(TextAlign.Center)
          .width(40)
      }
      .width(60)
      .height(20)
      .linearGradient({
        angle: 135,
        colors: [['#FD3F8F', 0], ['#FF773C', 1]]
      })
      .borderRadius({
        topRight: 10,
        bottomRight: 10
      })
    }
    .width(74)
    .height(116)
    .padding({ top: 8, bottom: 8 })
    .justifyContent(FlexAlign.SpaceBetween)
  }

  @Builder
  DiscountBuilder() {
    Column({ space: 8 }) {
      Image(this.goods.picture)
        .width(54)
        .aspectRatio(1)
      Text('¥' + Number(this.goods.price))
        .fontSize(12)
        .fontColor('#FF4B61')
        .fontWeight(500)
      Stack({ alignContent: Alignment.Top }) {
        Image($r('app.media.home_goods_discount'))
          .width(48)
          .height(20)
        Text('立减 90')
          .fontSize(8)
          .fontColor($r('[basic].color.white'))
          .lineHeight(12)
      }
    }
    .width(70)
    .height(116)
    .justifyContent(FlexAlign.Center)
  }

  @Builder
  NewBuilder() {
    Column() {
      Image(this.goods.picture)
        .width(60)
        .aspectRatio(1)
      Text('¥' + Number(this.goods.price))
        .fontSize(13)
        .lineHeight(30)
        .fontColor('#FF4B61')
        .fontWeight(500)
    }
    .padding(8)
    .width(80)
    .height(106)
    .borderRadius(8)
    .backgroundColor($r('[basic].color.white'))
    .justifyContent(FlexAlign.Center)
  }

  build() {
    if (this.type === DiscountType.DISCOUNT) {
      this.DiscountBuilder()
    } else if (this.type === DiscountType.NEW) {
      this.NewBuilder()
    } else {
      this.CommandBuilder()
    }
  }
}
```

- home的HDMGoods

```ts
features/home/src/main/ets/components/HDMGoods.ets

import { HDMGoodsItem } from 'basic'

@ComponentV2
export struct HDMGoods {
  @Param
  goods: HDMGoodsItem = {} as HDMGoodsItem
  @Param
  smallImage: boolean = false

  build() {
    Column({ space: 10 }) {
      if (this.smallImage) {
        Row() {
          Image(this.goods.picture)
            .width('100%')
            .aspectRatio(1)
        }
        .width('100%')
        .padding(20)
      } else {
        Image(this.goods.picture)
          .width('100%')
          .aspectRatio(1)
      }
      Text(this.goods.name)
        .fontSize(14)
        .fontColor($r('[basic].color.text'))
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .width('100%')
        .padding({ left: 10, right: 10 })
      Row({ space: 4 }) {
        Text('¥' + Number(this.goods.price))
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('[basic].color.black'))
        Text('¥999')
          .fontSize(8)
          .fontColor($r('[basic].color.gray'))
          .decoration({ type: TextDecorationType.LineThrough, color: $r('[basic].color.gray') })
        Blank()
        Text('2.9万+人付款')
          .fontSize(10)
          .fontColor($r('[basic].color.gray'))
      }
      .alignItems(VerticalAlign.Bottom)
      .width('100%')
      .margin({ bottom: 10 })
      .padding({ left: 10, right: 10 })
    }
    .width('100%')
    .backgroundColor($r('[basic].color.white'))
    .borderRadius(8)
    .clip(true)
  }
}
```

- 组件统一注册

```ts
features/home/src/main/ets/components/index.ets

export * from './HDMDiscountGoods'
export * from './HDMGoods'
```

- 类型文件

```ts
features/home/src/main/ets/viewmodels/home.ets


import { HDMGoodsItem } from "basic";

export interface Banner {
  id: string;
  imgUrl: string;
  type: string;
}


export interface Params {
  title: string,
  subTitle: string,
  bg: ResourceStr,
  list: HDMGoodsItem[]
}

export enum DiscountType {
  COMMAND,
  DISCOUNT,
  NEW
}
```

- 类型注册

```ts
features/home/src/main/ets/viewmodels/index.ets

export * from './home'
```

- Home主页的组件

```ts
features/home/src/main/ets/views/HomeView/HomeView.ets


import { CategoryItem, HDMGoodsItem } from 'basic'
import { HDMDiscountGoods, HDMGoods } from '../components'
import { Banner, Params, DiscountType } from '../viewmodels'


@ComponentV2
export struct HomeView {
  // 轮播图
  // 轮播图
  @Local
  banners: Banner[] = []
  // 分类
  @Local
  categories: CategoryItem[] = []
  // 特惠推荐
  @Local
  saleGoods: HDMGoodsItem[] = []
  // 爆款推荐
  @Local
  hotGoods: HDMGoodsItem[] = []
  // 一站买全
  @Local
  oneGoods: HDMGoodsItem[] = []
  // 新鲜好物
  @Local
  newGoods: HDMGoodsItem[] = []
  @Local
  recommendGoods: HDMGoodsItem[] = []

  // 生成模拟数据
  mockData() {
    this.banners = new Array(6).fill({
      id: "42",
      imgUrl: "https://yjy-teach-oss.oss-cn-beijing.aliyuncs.com/meikou/banner/nuandong_sj.png",
      hrefUrl: "/category/1181622006",
      type: "1"
    })

    this.categories = new Array(10).fill({
      id: "1181622001",
      name: "气质女装",
      picture: "https://yjy-teach-oss.oss-cn-beijing.aliyuncs.com/meikou/c1/qznz.png"
    })

    this.saleGoods = new Array(6).fill({
      "id": "1111002",
      "name": "剪出精致感，金致圆柄复古剪刀",
      "desc": "轻薄设计，简约大方",
      "price": "9.90",
      "picture": "https://yanxuan-item.nosdn.127.net/4c6a9c8a579b00e5e9c7b002d15a33a2.jpg",
      "orderNum": 172
    },)

    this.hotGoods = new Array(8).fill({
      "id": "1135059",
      "name": "手工八年老陈醋500毫升",
      "desc": "地道醇香，醋酸浓郁",
      "price": "30.00",
      "picture": "https://yanxuan-item.nosdn.127.net/77da20e77b02830a26f931901ac1a9e0.png",
      "orderNum": 147
    },)
    this.oneGoods = new Array(8).fill({
      "id": "1135079",
      "name": "免浸泡，12种谷物一次同享，五谷米400克",
      "desc": "无需浸泡，同煮同熟",
      "price": "9.90",
      "picture": "https://yanxuan-item.nosdn.127.net/bfe70bd66efe94f2f18061c707d2a097.png",
      "orderNum": 144
    })
    this.newGoods = new Array(8).fill({
      "id": "4027998",
      "name": "亮碟多效合一洗涤块495g",
      "desc": "洗碗机专用，强力去污",
      "price": "69.90",
      "picture": "https://yanxuan-item.nosdn.127.net/e07c2b63765cf9f4a46d489c6e09c1c1.jpg",
      "orderNum": 643
    })

    this.recommendGoods = new Array(8).fill({
      "id": "4033959",
      "name": "3秒快速拆琴轻松保养odin奥丁12半音阶口琴",
      "price": 329,
      "picture": "https://yanxuan-item.nosdn.127.net/937a8e46a9284e8f7e00e13911ecfbe7.png",
      "payCount": 0
    })
  }

  aboutToAppear(): void {
    // mock数据
    this.mockData()

  }

  @Builder
  DiscountBuilder(params: Params) {

    Column() {
      Row({ space: 10 }) {
        Text(params.title)
          .fontColor($r('[basic].color.black'))
          .fontSize(14)
        Text(params.subTitle)
          .fontColor($r('[basic].color.text'))
          .fontSize(11)
      }
      .width('100%')
      .margin({ bottom: 10 })

      List({ space: 10 }) {
        ForEach(params.list, (item: HDMGoodsItem) => {
          ListItem() {
            HDMDiscountGoods({ type: DiscountType.DISCOUNT, goods: item })
          }
        })
      }
      .width('100%')
      .height(116)
      .scrollBar(BarState.Off)
      .listDirection(Axis.Horizontal)
    }
    .height(160)
    .layoutWeight(1)
    .padding(10)
    .backgroundColor(params.bg)
    .borderRadius(8)
  }

  build() {
    Scroll() {
      Column() {
        // 轮播图 + 搜索
        Stack({ alignContent: Alignment.Top }) {
          Swiper() {
            ForEach(this.banners, (item: Banner) => {
              Image(item.imgUrl)
            })
          }
          .indicator(
            DotIndicator.dot()
              .itemWidth(8)
              .itemHeight(4)
              .color('#33191919')
              .selectedItemWidth(24)
              .selectedItemHeight(4)
              .selectedColor('#191919')
          )

          Row() {
            Row({ space: 4 }) {
              Image($r('[basic].media.ic_public_search'))
                .width(16)
                .height(16)
                .fillColor($r('[basic].color.white'))
              Text('搜索...')
                .fontSize(14)
                .fontColor($r('[basic].color.white'))
            }
            .backgroundColor('#33191919')
            .width('100%')
            .height(40)
            .borderRadius(20)
            .padding({ left: 12 })
          }
          .padding({ left: 16, right: 16 })
        }
        .width('100%')


        // 分类
        Column({ space: 10 }) {
          // 分类
          List({ space: 16 }) {
            ForEach(this.categories, (item: CategoryItem) => {
              ListItem() {
                Column() {
                  Image(item.picture)
                    .width(56)
                    .aspectRatio(1)
                  Text(item.name)
                    .fontSize(10)
                    .fontColor('#CC191919')
                }
                .width(60)
                .height(80)
                .borderRadius(30)

                .clip(true)
                .backgroundImage(item.picture)
                .backgroundImageSize(ImageSize.Contain)
                .backgroundImagePosition(Alignment.Center)
                .backgroundBlurStyle(
                  BlurStyle.BACKGROUND_ULTRA_THICK,
                  { scale: 0.25 }
                )
              }
            })
          }
          .width('100%')
          .height(92)
          .scrollBar(BarState.Off)
          .listDirection(Axis.Horizontal)
          .alignListItem(ListItemAlign.Center)

          // 特惠推荐
          Column({ space: 10 }) {
            Image($r('app.media.home_cmd_title'))
              .width(150)
              .height(20)
            Row() {
              Image($r('app.media.home_cmd_inner'))
                .width(86)
                .height(116)
              List({ space: 10 }) {
                ForEach(this.saleGoods, (item: HDMGoodsItem) => {
                  ListItem() {
                    HDMDiscountGoods({ goods: item })
                  }
                })
              }
              .layoutWeight(1)
              .width('100%')
              .height(116)
              .backgroundColor($r('[basic].color.white'))
              .borderRadius({
                topRight: 8,
                bottomRight: 8
              })
              .padding({ right: 10, left: 10 })
              .scrollBar(BarState.Off)
              .listDirection(Axis.Horizontal)
            }
          }
          .width('100%')
          .height(166)
          .backgroundImage($r('app.media.home_cmd_sm'))
          .backgroundImageSize(ImageSize.Cover)
          .borderRadius(8)
          .padding(10)
          .alignItems(HorizontalAlign.Start)

          // 爆款推荐+一站买全
          Row({ space: 10 }) {
            this.DiscountBuilder({
              title: '爆款推荐',
              subTitle: '最受欢迎',
              bg: '#EDF1FB',
              list: this.hotGoods
            })
            this.DiscountBuilder({
              title: '一站买全',
              subTitle: '精心优选',
              bg: '#FCF6EA',
              list: this.oneGoods
            })
          }

          // 新鲜好物
          Column({ space: 10 }) {
            Image($r('app.media.home_new'))
              .width(146)
              .height(19)
            List({ space: 10 }) {
              ForEach(this.newGoods, (item: HDMGoodsItem) => {
                ListItem() {
                  HDMDiscountGoods({ type: DiscountType.NEW, goods: item })
                }
              })
            }
            .width('100%')
            .height(116)
            .scrollBar(BarState.Off)
            .listDirection(Axis.Horizontal)
          }
          .width('100%')
          .height(156)
          .padding(10)
          .backgroundColor('#F7EFF5')
          .borderRadius(8)
          .alignItems(HorizontalAlign.Start)

          // 推荐商品
          WaterFlow() {
            ForEach(this.recommendGoods, (item: HDMGoodsItem) => {
              FlowItem() {
                HDMGoods({ goods: item })
              }
            })
          }
          .columnsTemplate('1fr 1fr')
          .columnsGap(8)
          .rowsGap(10)

        }
        .padding({
          left: 8,
          right: 8,
          bottom: 10,
          top: 10
        })
      }
    }
    .scrollBar(BarState.Off)
  }
}
```



### 1.2.2. 界面适配

完成 home模块的下的页面适配效果

[module.json5](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5)、[轮播图个数](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-layout-development-create-looping-V5)、[轮播图间隙](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-swiper-V5)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724127414305-8850e4bc-c8b3-4523-b536-3d4cc2d422a2.png)

**需求：**

1. 无法缩小到 xs 范围（2in1 设备才可以测试效果）
2. 轮播图：

1. 1. sm：一张图，导航点，无间隙
   2. md：2 张图，无导航点，10 间隙
   3. lg：3 张图，无导航点，20 间隙

1. 分类
2. 特惠推荐
3. 新鲜好物

1. 1. 上面 3 个都是 space：sm：14，md：36，lg：72

1. 推荐商品

1. 1. sm：2 列
   2. md：3 列
   3. lg：4 列

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717426969641-95239595-597e-429d-bfd8-50cb258df934.png)![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717426985963-e1f8fc28-3cee-4568-8c60-03ba4448ebd5.png)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717427008175-6dbb2691-fd39-4ca5-b621-fa68fa208bac.png)

轮播图的适配

推荐好物的适配

新鲜好物的适配

```ts
features/home/src/main/ets/views/HomeView.ets


import { AppBreakPoint, BreakPointEnum, BreakPointType, CategoryItem, HDMGoodsItem } from 'basic'
import { HDMDiscountGoods, HDMGoods } from '../components'
import { Banner, Params, DiscountType } from '../viewmodels'
import { AppStorageV2 } from '@kit.ArkUI'


@ComponentV2
export struct HomeView {
  breakObj: AppBreakPoint = AppStorageV2.connect(AppBreakPoint, () => new AppBreakPoint())!
  // 轮播图
  // 轮播图
  @Local
  banners: Banner[] = []
  // 分类
  @Local
  categories: CategoryItem[] = []
  // 特惠推荐
  @Local
  saleGoods: HDMGoodsItem[] = []
  // 爆款推荐
  @Local
  hotGoods: HDMGoodsItem[] = []
  // 一站买全
  @Local
  oneGoods: HDMGoodsItem[] = []
  // 新鲜好物
  @Local
  newGoods: HDMGoodsItem[] = []
  @Local
  recommendGoods: HDMGoodsItem[] = []

  // 生成模拟数据
  mockData() {
    this.banners = new Array(6).fill({
      id: "42",
      imgUrl: "https://yjy-teach-oss.oss-cn-beijing.aliyuncs.com/meikou/banner/nuandong_sj.png",
      hrefUrl: "/category/1181622006",
      type: "1"
    })

    this.categories = new Array(10).fill({
      id: "1181622001",
      name: "气质女装",
      picture: "https://yjy-teach-oss.oss-cn-beijing.aliyuncs.com/meikou/c1/qznz.png"
    })

    this.saleGoods = new Array(6).fill({
      "id": "1111002",
      "name": "剪出精致感，金致圆柄复古剪刀",
      "desc": "轻薄设计，简约大方",
      "price": "9.90",
      "picture": "https://yanxuan-item.nosdn.127.net/4c6a9c8a579b00e5e9c7b002d15a33a2.jpg",
      "orderNum": 172
    },)

    this.hotGoods = new Array(8).fill({
      "id": "1135059",
      "name": "手工八年老陈醋500毫升",
      "desc": "地道醇香，醋酸浓郁",
      "price": "30.00",
      "picture": "https://yanxuan-item.nosdn.127.net/77da20e77b02830a26f931901ac1a9e0.png",
      "orderNum": 147
    },)
    this.oneGoods = new Array(8).fill({
      "id": "1135079",
      "name": "免浸泡，12种谷物一次同享，五谷米400克",
      "desc": "无需浸泡，同煮同熟",
      "price": "9.90",
      "picture": "https://yanxuan-item.nosdn.127.net/bfe70bd66efe94f2f18061c707d2a097.png",
      "orderNum": 144
    })
    this.newGoods = new Array(8).fill({
      "id": "4027998",
      "name": "亮碟多效合一洗涤块495g",
      "desc": "洗碗机专用，强力去污",
      "price": "69.90",
      "picture": "https://yanxuan-item.nosdn.127.net/e07c2b63765cf9f4a46d489c6e09c1c1.jpg",
      "orderNum": 643
    })

    this.recommendGoods = new Array(8).fill({
      "id": "4033959",
      "name": "3秒快速拆琴轻松保养odin奥丁12半音阶口琴",
      "price": 329,
      "picture": "https://yanxuan-item.nosdn.127.net/937a8e46a9284e8f7e00e13911ecfbe7.png",
      "payCount": 0
    })
  }

  aboutToAppear(): void {
    // mock数据
    this.mockData()

  }

  @Builder
  DiscountBuilder(params: Params) {

    Column() {
      Row({ space: 10 }) {
        Text(params.title)
          .fontColor($r('[basic].color.black'))
          .fontSize(14)
        Text(params.subTitle)
          .fontColor($r('[basic].color.text'))
          .fontSize(11)
      }
      .width('100%')
      .margin({ bottom: 10 })

      List({ space: 10 }) {
        ForEach(params.list, (item: HDMGoodsItem) => {
          ListItem() {
            HDMDiscountGoods({ type: DiscountType.DISCOUNT, goods: item })
          }
        })
      }
      .width('100%')
      .height(116)
      .scrollBar(BarState.Off)
      .listDirection(Axis.Horizontal)
    }
    .height(160)
    .layoutWeight(1)
    .padding(10)
    .backgroundColor(params.bg)
    .borderRadius(8)
  }

  build() {
    Scroll() {
      Column() {
        // 轮播图 + 搜索
        Stack({ alignContent: Alignment.Top }) {
          Swiper() {
            ForEach(this.banners, (item: Banner) => {
              Image(item.imgUrl)
            })
          }
          .displayCount(new BreakPointType({
            sm: 1,
            md: 2,
            lg: 3
          }).getValue(this.breakObj.breakPoint))
          .itemSpace(new BreakPointType({
            sm: 0,
            md: 10,
            lg: 20
          }).getValue(this.breakObj.breakPoint))
          .indicator(
            this.breakObj.breakPoint === BreakPointEnum.SM ?
            DotIndicator.dot()
              .itemWidth(8)
              .itemHeight(4)
              .color('#33191919')
              .selectedItemWidth(24)
              .selectedItemHeight(4)
              .selectedColor('#191919') : false
          )

          Row() {
            Row({ space: 4 }) {
              Image($r('[basic].media.ic_public_search'))
                .width(16)
                .height(16)
                .fillColor($r('[basic].color.white'))
              Text('搜索...')
                .fontSize(14)
                .fontColor($r('[basic].color.white'))
            }
            .backgroundColor('#33191919')
            .width('100%')
            .height(40)
            .borderRadius(20)
            .padding({ left: 12 })
          }
          .padding({ left: 16, right: 16 })
        }
        .width('100%')


        // 分类
        Column({ space: 10 }) {
          // 分类
          List({
            space: new BreakPointType({
              sm: 14,
              md: 36,
              lg: 72
            }).getValue(this.breakObj.breakPoint)
          }) {
            ForEach(this.categories, (item: CategoryItem) => {
              ListItem() {
                Column() {
                  Image(item.picture)
                    .width(56)
                    .aspectRatio(1)
                  Text(item.name)
                    .fontSize(10)
                    .fontColor('#CC191919')
                }
                .width(60)
                .height(80)
                .borderRadius(30)

                .clip(true)
                .backgroundImage(item.picture)
                .backgroundImageSize(ImageSize.Contain)
                .backgroundImagePosition(Alignment.Center)
                .backgroundBlurStyle(
                  BlurStyle.BACKGROUND_ULTRA_THICK,
                  { scale: 0.25 }
                )
              }
            })
          }
          .width('100%')
          .height(92)
          .scrollBar(BarState.Off)
          .listDirection(Axis.Horizontal)
          .alignListItem(ListItemAlign.Center)

          // 特惠推荐
          Column({ space: 10 }) {
            Image($r('app.media.home_cmd_title'))
              .width(150)
              .height(20)
            Row() {
              Image($r('app.media.home_cmd_inner'))
                .width(86)
                .height(116)
              List({ space: 10 }) {
                ForEach(this.saleGoods, (item: HDMGoodsItem) => {
                  ListItem() {
                    HDMDiscountGoods({ goods: item })
                  }
                })
              }
              .layoutWeight(1)
              .width('100%')
              .height(116)
              .backgroundColor($r('[basic].color.white'))
              .borderRadius({
                topRight: 8,
                bottomRight: 8
              })
              .padding({ right: 10, left: 10 })
              .scrollBar(BarState.Off)
              .listDirection(Axis.Horizontal)
            }
          }
          .width('100%')
          .height(166)
          .backgroundImage($r('app.media.home_cmd_sm'))
          .backgroundImageSize(ImageSize.Cover)
          .borderRadius(8)
          .padding(10)
          .alignItems(HorizontalAlign.Start)

          // 爆款推荐+一站买全
          Row({ space: 10 }) {
            this.DiscountBuilder({
              title: '爆款推荐',
              subTitle: '最受欢迎',
              bg: '#EDF1FB',
              list: this.hotGoods
            })
            this.DiscountBuilder({
              title: '一站买全',
              subTitle: '精心优选',
              bg: '#FCF6EA',
              list: this.oneGoods
            })
          }

          // 新鲜好物
          Column({ space: 10 }) {
            Image($r('app.media.home_new'))
              .width(146)
              .height(19)
            List({
              space: new BreakPointType({
                sm: 14,
                md: 36,
                lg: 72
              }).getValue(this.breakObj.breakPoint)
            }) {
              ForEach(this.newGoods, (item: HDMGoodsItem) => {
                ListItem() {
                  HDMDiscountGoods({ type: DiscountType.NEW, goods: item })
                }
              })
            }
            .width('100%')
            .height(116)
            .scrollBar(BarState.Off)
            .listDirection(Axis.Horizontal)
          }
          .width('100%')
          .height(156)
          .padding(10)
          .backgroundColor('#F7EFF5')
          .borderRadius(8)
          .alignItems(HorizontalAlign.Start)

          // 推荐商品
          WaterFlow() {
            ForEach(this.recommendGoods, (item: HDMGoodsItem) => {
              FlowItem() {
                HDMGoods({ goods: item })
              }
            })
          }
          .columnsTemplate(new BreakPointType({
            sm: "1fr 1fr",
            md: "1fr 1fr 1fr",
            lg: "1fr 1fr 1fr 1fr"
          }).getValue(this.breakObj.breakPoint))
          .columnsGap(8)
          .rowsGap(10)

        }
        .padding({
          left: 8,
          right: 8,
          bottom: 10,
          top: 10
        })
      }
    }
    .scrollBar(BarState.Off)
  }
}
```

![img](https://cdn.nlark.com/yuque/0/2025/png/8435673/1743044288152-ad1df2e4-2b67-478d-9c94-ecdbe0f70984.png)

- 平板去除切换动画

```typescript
import { AppBreakPoint, BreakPointType, TabItem } from 'basic'
import { CartView } from 'cart'
import { CategoryView } from 'category'
import { HomeView } from 'home'
import { MineView } from 'mine'
import { AppStorageV2 } from '@kit.ArkUI'

@Entry
@ComponentV2
struct Index {
  breakObj: AppBreakPoint = AppStorageV2.connect(AppBreakPoint, () => new AppBreakPoint())!
  @Local
  activeIndex: number = 0
  list: TabItem[] = [
    { text: '首页', normal: $r('app.media.ic_public_home_normal'), active: $r('app.media.ic_public_home_active') },
    { text: '分类', normal: $r('app.media.ic_public_pro_normal'), active: $r('app.media.ic_public_pro_active') },
    { text: '购物袋', normal: $r('app.media.ic_public_cart_normal'), active: $r('app.media.ic_public_cart_active') },
    { text: '我的', normal: $r('app.media.ic_public_my_normal'), active: $r('app.media.ic_public_my_active') },
  ]

  @Builder
  getTabItemBuilder(item: TabItem, index: number) {
    Column() {
      Image(this.activeIndex === index ? item.active : item.normal)
        .width(24)
        .aspectRatio(1)
      Text(item.text)// 跨 HSP 访问资源，需要在 oh-package.json5中导入
        .fontColor($r("[basic].color.black"))
        .fontSize(12)
    }
    .justifyContent(FlexAlign.SpaceEvenly)
    .height(50)
  }

  build() {
    Tabs({
      barPosition: new BreakPointType({
        sm: BarPosition.End,
        md: BarPosition.End,
        lg: BarPosition.Start
      }).getValue(this.breakObj.breakPoint), index: $$this.activeIndex
    }) {
      ForEach(this.list, (item: TabItem, index: number) => {
        TabContent() {
          if (index === 0) {
            HomeView()
          } else if (index === 1) {
            CategoryView()
          } else if (index === 2) {
            CartView()
          } else {
            MineView()
          }
        }
        .tabBar(this.getTabItemBuilder(item, index))
      })
    }
    .barHeight(new BreakPointType({
      sm: 60,
      md: 60,
      lg: 220
    }).getValue(this.breakObj.breakPoint))
    .vertical(new BreakPointType({
      sm: false,
      md: false,
      lg: true
    }).getValue(this.breakObj.breakPoint))
    .scrollable(false)
    .animationDuration(new BreakPointType({
      sm: 300,
      md: 300,
      lg: 0
    }).getValue(this.breakObj.breakPoint))
  }
}
```





### 1.2.3. 沉浸式导航

接下来完成沉浸式导航

[deviceinfo](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-device-info-V5)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1717429649856-21153adc-97a0-4171-8d35-7980da7feea7.png)

![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724137444194-607e53a0-b23b-43a0-8967-3d768a4c41e5.png)![img](https://cdn.nlark.com/yuque/0/2024/png/639379/1724137519869-422e3b0b-02ae-44df-99a5-1cbb2f82d953.png)

**需求：**

1. 非 2in1 模式下开启沉浸式导航
2. 设置顶部安全区域（home）及底部安全区域（tabs）

| **设备类型** | **枚举值** | **说明**                             |
| ------------ | ---------- | ------------------------------------ |
| 手机         | phone      | -                                    |
| 平板         | tablet     | -                                    |
| 2in1设备     | 2in1       | -                                    |
| 智慧屏       | tv         | -                                    |
| 智能手表     | wearable   | 系统能力较丰富的手表，具备电话功能。 |
| 车机         | car        | -                                    |

**核心步骤：**

- 沿用了小时达项目的沉浸式导航的方法-加入一个判断是否为电脑设备
- 在ability中调用实现沉浸式全屏
- 定义一个全局缓存安全区高度的对象

```typescript
commons/basic/src/main/ets/viewmodels/common.ets

// 存储当前全局安全区的对象
@ObservedV2
export class AppSafeArea {
  @Trace
  topHeight: number = 0
  @Trace
  bottomHeight: number = 0
}
```

- commons/basic/utils/ScreenManager.ets

```ts
import { Context } from "@kit.AbilityKit"
import { AppStorageV2, display, window } from "@kit.ArkUI"
import { AppBreakPoint, AppSafeArea, BreakPointEnum } from "../viewmodels"
import { deviceInfo } from "@kit.BasicServicesKit"

export class ScreenManager {
  ctx?: Context

  // 注册屏幕宽度变化
  async registerWindowSizeChange() {
    const win = await this.getWin() // 获取window对象
    this.judgeScreen(px2vp(display.getDefaultDisplaySync().width)) // 第一次手动判断一次
    win.on("windowSizeChange", (size) => {
      this.judgeScreen(px2vp(size.width)) // vp区间
    })
  }

  // 判断屏幕
  judgeScreen(width: number) {
    let breakPoint: BreakPointEnum = BreakPointEnum.XS
    if (width > 0 && width < 320) {
      breakPoint = BreakPointEnum.XS
    } else if (width >= 320 && width < 520) {
      breakPoint = BreakPointEnum.SM
    } else if (width >= 520 && width < 840) {
      breakPoint = BreakPointEnum.MD
    } else {
      breakPoint = BreakPointEnum.LG
    }
    //   V1 AppStorage.setOrCreate("key", "value")
    const app = AppStorageV2.connect(AppBreakPoint, () => new AppBreakPoint())!
    app.breakPoint = breakPoint // 将断点值存入到全局状态
  }

  // 取消注册
  async unRegisterWindowSizeChange() {
    const win = await this.getWin() // 获取window对象
    win.off("windowSizeChange") // 卸载监听
  }

  // 全屏
  async full() {
    const win = await this.getWin()
    win.setWindowLayoutFullScreen(true)
    this.setAreaHeight(deviceInfo.deviceType === "2in1" ? 0 :
    px2vp(win.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM).topRect.height),
      px2vp(deviceInfo.deviceType === "2in1" ? 0 :
      win.getWindowAvoidArea(window.AvoidAreaType.TYPE_NAVIGATION_INDICATOR).bottomRect.height))
    // 顶部安全区高度
    // 底部安全区高度
  }

  // 退出全屏
  async exitFull() {
    const win = await this.getWin()
    win.setWindowLayoutFullScreen(false)
    this.setAreaHeight(0, 0)
  }

  // 设置安全区高度
  setAreaHeight(top: number, bottom: number) {
    const app = AppStorageV2.connect(AppSafeArea, () => new AppSafeArea())!
    app.topHeight = top
    app.bottomHeight = bottom
  }

  getWin() {
    return window.getLastWindow(this.ctx || getContext())
  }
}

export const screenManager = new ScreenManager()
```

- 在phone的ability中实现全屏

```ts
products/phone/src/main/ets/entryability/EntryAbility.ets

onWindowStageCreate(windowStage: window.WindowStage): void {
    // Main window is created, set main page for this ability
    hilog.info(DOMAIN, 'testTag', '%{public}s', 'Ability onWindowStageCreate');
    screenManager.ctx = this.context
    screenManager.registerWindowSizeChange() // 注册屏幕变化
    screenManager.full() // 实现沉浸式全屏
    windowStage.loadContent('pages/Index', (err) => {
      if (err.code) {
        hilog.error(DOMAIN, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err));
        return;
      }
      hilog.info(DOMAIN, 'testTag', 'Succeeded in loading the content.');
    });
  }
```

- 实现顶部距离的安全区避让

  ```ts
  features/home/src/main/ets/views/HomeView/HomeView.ets
    safeArea: AppSafeArea = AppStorageV2.connect(AppSafeArea, () => new AppSafeArea())!
  
  ```

  

```ts
          Row() {
            Row({ space: 4 }) {
              Image($r('[basic].media.ic_public_search'))
                .width(16)
                .height(16)
                .fillColor($r('[basic].color.white'))
              Text('搜索...')
                .fontSize(14)
                .fontColor($r('[basic].color.white'))
            }
            .backgroundColor('#33191919')
            .width('100%')
            .height(40)
            .borderRadius(20)
            .padding({ left: 12 })
          }
          .padding({
            left: 16,
            right: 16,
            top:  this.safeArea.topHeight
          })
```

- Index页面处理底部安全区

```ts
products/phone/src/main/ets/pages/Index.ets

safeArea: AppSafeArea = AppStorageV2.connect(AppSafeArea, () => new AppSafeArea())!

 .padding({
      bottom: this.safeArea.bottomHeight
    })
```

![img](https://cdn.nlark.com/yuque/0/2025/png/8435673/1743045816038-1f417dc3-eb92-4c5a-844a-ef8c31eab5c7.png)



